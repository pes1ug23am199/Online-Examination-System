{% extends 'base.html' %}
{% block content %}
<div class="card">
  <div class="row" style="justify-content:space-between; align-items:center">
    <div>
      <h2 class="h2" style="margin:0">{{ quiz.quiz_title or 'Quiz' }}</h2>
      <p class="lead" style="margin:0">{{ quiz.subject_name }}</p>
    </div>
    <div class="h2" id="timer" style="margin:0"></div>
  </div>
  <form method="post" class="stack" id="quiz-form">
    {% set total = questions|length %}
    {% for q in questions %}
      <div class="question" data-index="{{ loop.index0 }}" style="display:none">
        <p><strong>Q{{ loop.index }} of {{ total }}.</strong> {{ q.question_text }}</p>
        <div class="stack">
          {% for opt,label in [('A', q.option_a), ('B', q.option_b), ('C', q.option_c), ('D', q.option_d)] %}
            <label class="row">
              <input type="radio" name="q_{{ q.question_id }}" value="{{ opt }}" />
              <span>{{ opt }}. {{ label }}</span>
            </label>
          {% endfor %}
        </div>
      </div>
    {% else %}
      <p>No questions in this quiz.</p>
    {% endfor %}
    <div class="quiz-nav">
      <div class="left">
        <button type="button" class="btn btn-ghost" id="prev-btn">Previous</button>
      </div>
      <div class="right">
        <button type="button" class="btn btn-ghost" id="next-btn">Next</button>
        <button type="submit" class="btn btn-primary" id="submit-btn" style="display:none">Submit Answers</button>
      </div>
    </div>
  </form>
</div>
<script>
(function(){
  // Timer
  var mins = parseInt('{{ quiz.duration_minutes|default(0) }}');
  if (!isNaN(mins) && mins > 0){
    var total = mins*60; var timerEl = document.getElementById('timer');
    var iv = setInterval(function(){
      total--; if (total < 0){ clearInterval(iv); document.getElementById('quiz-form').submit(); return; }
      var m = Math.floor(total/60), s = total%60; timerEl.textContent = (m+':'+('0'+s).slice(-2));
    }, 1000);
  }
  // Pager
  var qs = Array.prototype.slice.call(document.querySelectorAll('.question'));
  var i = 0;
  var prevBtn = document.getElementById('prev-btn');
  var nextBtn = document.getElementById('next-btn');
  var submitBtn = document.getElementById('submit-btn');
  function show(idx){
    qs.forEach(function(el, j){ el.style.display = (j===idx)?'block':'none'; });
    prevBtn.disabled = (idx===0);
    if (idx === qs.length-1){ nextBtn.style.display='none'; submitBtn.style.display='inline-flex'; }
    else { nextBtn.style.display='inline-flex'; submitBtn.style.display='none'; }
  }
  if (qs.length){ show(0); }
  prevBtn.addEventListener('click', function(){ if (i>0){ i--; show(i); } });
  nextBtn.addEventListener('click', function(){ if (i<qs.length-1){ i++; show(i); } });
  // Keyboard arrows
  document.addEventListener('keydown', function(e){ if(e.key==='ArrowRight'){ nextBtn.click(); } if(e.key==='ArrowLeft'){ prevBtn.click(); } });
})();
</script>
{% endblock %}
