{% extends 'base.html' %}
{% block content %}
<div class="stack">
  <div class="card">
    <div class="row" style="justify-content:space-between">
      <h2 class="h2" style="margin:0">Welcome, {{ staff_name }}</h2>
      <a class="btn btn-ghost" href="{{ url_for('staff_logout') }}">Logout</a>
    </div>
  </div>

<div class="card">
  <div class="row" style="justify-content:space-between; align-items:center">
    <h2 class="h2" style="margin:0">Create Quiz</h2>
    <a class="btn btn-ghost" href="{{ url_for('staff_results') }}">View Results by Quiz</a>
  </div>
  <form method="post" action="{{ url_for('staff_create_quiz') }}" class="form stack">
    <div class="field">
      <label for="subject_id">Subject</label>
      <select id="subject_id" name="subject_id" class="select" required>
        <option value="" disabled selected>Select a subject</option>
        {% for s in subjects %}
          <option value="{{ s.subject_id }}">{{ s.subject_name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="field">
      <label for="quiz_title">Quiz Title</label>
      <input id="quiz_title" class="input" type="text" name="quiz_title" required />
    </div>
    <div class="row" style="gap:1rem; flex-wrap:wrap">
      <div class="field" style="flex:1 1 220px">
        <label for="date">Date</label>
        <input id="date" class="input" type="date" name="date" required />
      </div>
      <div class="field" style="flex:1 1 220px">
        <label for="duration_minutes">Duration (minutes)</label>
        <input id="duration_minutes" class="input" type="number" min="1" name="duration_minutes" required />
      </div>
    </div>
    <button type="submit" class="btn btn-primary">Create Quiz</button>
  </form>
</div>

<div class="card">
  <h2 class="h2">Existing Quizzes</h2>
  {% if quizzes_full and quizzes_full|length %}
  <table class="table">
    <thead>
      <tr><th>Subject</th><th>Title</th><th>Date</th><th>Duration</th><th></th></tr>
    </thead>
    <tbody>
      {% for q in quizzes_full %}
      <tr>
        <td>{{ q.subject_name }}</td>
        <td>{{ q.quiz_title }}</td>
        <td>{{ q.date }}</td>
        <td>{{ q.duration_minutes }} min</td>
        <td style="text-align:right">
          <button type="button" class="btn btn-ghost" onclick="(function(){var sel=document.getElementById('quiz_id'); if(sel){ sel.value='{{ q.quiz_id }}'; sel.dispatchEvent(new Event('change')); }})();">Add Question</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
    <p>No quizzes yet.</p>
  {% endif %}
</div>

<div class="card">
  <h2 class="h2">Add Question</h2>
  <form method="post" action="{{ url_for('staff_add_question') }}" class="form stack">
      <div class="field">
        <label for="quiz_id">Quiz</label>
        <select id="quiz_id" name="quiz_id" class="select" required>
          <option value="" disabled selected>Select a quiz</option>
          {% for q in quizzes %}
            <option value="{{ q.quiz_id }}">{{ q.quiz_title }} (#{{ q.quiz_id }})</option>
          {% endfor %}
        </select>
      </div>
      <div class="field">
        <label for="question_text">Question</label>
        <textarea id="question_text" class="textarea" name="question_text" rows="3" required></textarea>
      </div>
      <div class="row" style="gap:1rem; flex-wrap:wrap">
        <div class="field" style="flex:1 1 220px">
          <label for="option_a">Option A</label>
          <input id="option_a" class="input" type="text" name="option_a" required />
        </div>
        <div class="field" style="flex:1 1 220px">
          <label for="option_b">Option B</label>
          <input id="option_b" class="input" type="text" name="option_b" required />
        </div>
        <div class="field" style="flex:1 1 220px">
          <label for="option_c">Option C</label>
          <input id="option_c" class="input" type="text" name="option_c" required />
        </div>
        <div class="field" style="flex:1 1 220px">
          <label for="option_d">Option D</label>
          <input id="option_d" class="input" type="text" name="option_d" required />
        </div>
      </div>
      <div class="field">
        <label for="correct_option">Correct Option</label>
        <select id="correct_option" name="correct_option" class="select" required>
          <option value="A">A</option>
          <option value="B">B</option>
          <option value="C">C</option>
          <option value="D">D</option>
        </select>
      </div>
      <button type="submit" class="btn btn-primary">Add Question</button>
    </form>
  </div>
</div>
{% endblock %}
